'use strict';

const { isPersistedOnDatabase } = require('../model/csnUtils.js');

/**
 * Check that we don't have parameterized views - as we don't know yet how to represent them on postgres
 *
 * @param {object} parent Object with .params
 * @param {string} name Name of the params property on parent
 * @param {object} params params
 * @param {CSN.Path} path
 */
function checkForParams( parent, name, params, path ) {
  const artifact = this.csn.definitions[path[1]];
  if (artifact.kind === 'entity' && isPersistedOnDatabase(artifact) && parent.kind === 'entity') {
    this.error('ref-unexpected-params', [ ...path, 'params' ], { value: this.options.sqlDialect },
               'Parameterized views can\'t be used with sqlDialect $(VALUE)');
  }
}

module.exports = {
  params: checkForParams,
};
