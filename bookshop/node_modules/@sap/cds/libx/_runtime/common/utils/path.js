const { ensureNoDraftsSuffix } = require('./draft')

/*
 * returns the target entity for the given path
 */
const getEntityFromPath = (path, def) => {
  let current = def.definitions ? { elements: def.definitions } : def

  let id
  for (const segment of path.ref) {
    id = ensureNoDraftsSuffix(segment.id || segment)
    current = current?.elements[id] || current
    if (current && current.target) current = current._target
  }
  return current
}

module.exports = {
  getEntityFromPath
}
